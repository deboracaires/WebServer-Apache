<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat WebSocket</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #chat {
            height: 75vh;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: white;
            text-align: left;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        hr {
            background-color: black;
        }

        video {
            width: 80vw;
        }
    </style>
</head>

<body class="bg-gray-800 m-0 p-0 w-screen h-screen flex text-white">
    <section id="room" class="w-full">
        <div class="p-8 w-full flex flex-col justify-center items-center gap-6 h-full">
            <h1 class="text-2xl font-bold">
                Escolha um tema para entrar no chat
            </h1>

            <section class="h-full w-full flex justify-center items-center px-8">
                <div class="grid grid-cols-1 gap-8 w-full">
                    <button class="flex justify-center items-center bg-blue-500 h-40 rounded-2xl hover:bg-blue-700">
                        <h2 class="text-3xl font-extrabold">Algoritmos</h2>
                    </button>
                    <button class="flex justify-center items-center bg-blue-500 h-40 rounded-2xl hover:bg-blue-700">
                        <h2 class="text-3xl font-extrabold">Modelo OSI</h2>
                    </button>
                    <button class="flex justify-center items-center bg-blue-500 h-40 rounded-2xl hover:bg-blue-700">
                        <h2 class="text-3xl font-extrabold">Protocolo HTTP</h2>
                    </button>
                    <button class="flex justify-center items-center bg-blue-500 h-40 rounded-2xl hover:bg-blue-700">
                        <h2 class="text-3xl font-extrabold">Roteamento</h2>
                    </button>
                </div>
            </section>
        </div>
    </section>
    <div class="h-screen border-l border-gray-700"></div>
    <section class="w-80 p-6 gap-2 flex flex-col">
        <p class="text-lg font-bold ">Membros do chat</p>
        <ul id="members" class="text-lg">
            <!-- <li>artur - online</li> -->
        </ul>
    </section>
</body>

<script>
    const nomeUsuario = prompt("Digite seu nome de usuário:");

    if (!nomeUsuario) {
        alert("Nome de usuário é obrigatório. Recarregue a página e insira um nome.");
        throw new Error("Nome de usuário não fornecido.");
    }

    const socket = new WebSocket("ws://localhost:8765");
    const chatDiv = document.getElementById("chat");
    const membersList = document.getElementById("members");
    const videoContainer = document.getElementById("video-container");
    const videoInput = document.getElementById("videoInput");

    socket.onopen = () => {
        // Enviar o nome de usuário ao servidor quando a conexão é estabelecida
        socket.send(nomeUsuario);
    };

    socket.onmessage = (event) => {
        const mensagem = event.data;
        console.log(mensagem)

        // Verificar se a mensagem é um vídeo
        if (mensagem.startsWith("VIDEO:")) {
            exibirVideo(nomeUsuario, mensagem.substring(6));
        } else if (mensagem.startsWith("STATUS:")) {
            const [, nomeUsuario, status] = mensagem.split(':');
            const membroCadastrado = document.getElementById(nomeUsuario);

            if (membroCadastrado) membroCadastrado.textContent = `${nomeUsuario} - ${status}`;
            else {
                const novoMembro = document.createElement("li");
                novoMembro.textContent = `${nomeUsuario} - Online`;
                novoMembro.id = nomeUsuario;
                membersList.appendChild(novoMembro);
            }
        }
        else {
            // Se não for um vídeo, exibir como mensagem de texto no chat
            const mensagemRecebida = document.createElement("p");
            mensagemRecebida.textContent = mensagem;
            chatDiv.appendChild(mensagemRecebida);
        }
    };
</script>

</html>